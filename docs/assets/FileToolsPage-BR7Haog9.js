import{g as de,r as y,c as x,x as me,z as ce,m as fe,h as O,A as ve,aO as pe,aP as ge,aQ as ye,aR as be,aS as he,aT as Fe,aU as se,aV as xe,aW as we,v as Ce,ay as Ve,a3 as oe,a4 as H,a5 as N,f as u,am as te,ae,ag as W,an as le,a6 as b,a7 as ne,ai as K,ab as ie,af as I,ao as Y,ax as ke}from"./index-Diujp8v7.js";import{a as Pe,Q as re}from"./QSelect-BgsxzK3F.js";import{h as Se}from"./format-DyQxkAtJ.js";import{Q as Ae}from"./QPage-rDFG9wNg.js";import{u as _e}from"./use-quasar-CSzWwFYe.js";import"./QItem-B11hcjTb.js";import"./QItemLabel-D96q5sWu.js";import"./position-engine-7x5zhLB5.js";import"./selection-M1LSKmIB.js";function $(a,i,q,V){const r=[];return a.forEach(m=>{V(m)===!0?r.push(m):i.push({failedPropValidation:q,file:m})}),r}function J(a){a?.dataTransfer&&(a.dataTransfer.dropEffect="copy"),ce(a)}const Ue={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Be=["rejected"];function De({editable:a,dnd:i,getFileInput:q,addFilesToQueue:V}){const{props:r,emit:m,proxy:w}=de(),h=y(null),L=x(()=>r.accept!==void 0?r.accept.split(",").map(l=>(l=l.trim(),l==="*"?"*/":(l.endsWith("/*")&&(l=l.slice(0,l.length-1)),l.toUpperCase()))):null),k=x(()=>parseInt(r.maxFiles,10)),P=x(()=>parseInt(r.maxTotalSize,10));function S(l){if(a.value)if(l!==Object(l)&&(l={target:null}),l.target?.matches('input[type="file"]')===!0)l.clientX===0&&l.clientY===0&&me(l);else{const p=q();p!==l.target&&p?.click(l)}}function T(l){a.value&&l&&V(null,l)}function R(l,p,F,_){let o=Array.from(p||l.target.files);const g=[],A=()=>{g.length!==0&&m("rejected",g)};if(r.accept!==void 0&&L.value.indexOf("*/")===-1&&(o=$(o,g,"accept",s=>L.value.some(v=>s.type.toUpperCase().startsWith(v)||s.name.toUpperCase().endsWith(v))),o.length===0))return A();if(r.maxFileSize!==void 0){const s=parseInt(r.maxFileSize,10);if(o=$(o,g,"max-file-size",v=>v.size<=s),o.length===0)return A()}if(r.multiple!==!0&&o.length!==0&&(o=[o[0]]),o.forEach(s=>{s.__key=s.webkitRelativePath+s.lastModified+s.name+s.size}),_===!0){const s=F.map(v=>v.__key);o=$(o,g,"duplicate",v=>s.includes(v.__key)===!1)}if(o.length===0)return A();if(r.maxTotalSize!==void 0){let s=_===!0?F.reduce((v,M)=>v+M.size,0):0;if(o=$(o,g,"max-total-size",v=>(s+=v.size,s<=P.value)),o.length===0)return A()}if(typeof r.filter=="function"){const s=r.filter(o);o=$(o,g,"filter",v=>s.includes(v))}if(r.maxFiles!==void 0){let s=_===!0?F.length:0;if(o=$(o,g,"max-files",()=>(s++,s<=k.value)),o.length===0)return A()}if(A(),o.length!==0)return o}function j(l){J(l),i.value!==!0&&(i.value=!0)}function d(l){ce(l),(l.relatedTarget!==null||fe.is.safari!==!0?l.relatedTarget!==h.value:document.elementsFromPoint(l.clientX,l.clientY).includes(h.value)===!1)===!0&&(i.value=!1)}function Q(l){J(l);const p=l.dataTransfer.files;p.length!==0&&V(null,p),i.value=!1}function X(l){if(i.value===!0)return O("div",{ref:h,class:`q-${l}__dnd absolute-full`,onDragenter:J,onDragover:J,onDragleave:d,onDrop:Q})}return Object.assign(w,{pickFiles:S,addFiles:T}),{pickFiles:S,addFiles:T,onDragover:j,onDragleave:d,processFiles:R,getDndNode:X,maxFilesNumber:k,maxTotalSizeNumber:P}}const ue=ve({name:"QFile",inheritAttrs:!1,props:{...ye,...ge,...Ue,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...pe,...Be],setup(a,{slots:i,emit:q,attrs:V}){const{proxy:r}=de(),m=be(),w=y(null),h=y(!1),L=he(a),{pickFiles:k,onDragover:P,onDragleave:S,processFiles:T,getDndNode:R}=De({editable:m.editable,dnd:h,getFileInput:G,addFilesToQueue:U}),j=Fe(a),d=x(()=>Object(a.modelValue)===a.modelValue?"length"in a.modelValue?Array.from(a.modelValue):[a.modelValue]:[]),Q=x(()=>se(d.value)),X=x(()=>d.value.map(e=>e.name).join(", ")),l=x(()=>Se(d.value.reduce((e,t)=>e+t.size,0))),p=x(()=>({totalSize:l.value,filesNumber:d.value.length,maxFiles:a.maxFiles})),F=x(()=>({tabindex:-1,type:"file",title:"",accept:a.accept,capture:a.capture,name:L.value,...V,id:m.targetUid.value,disabled:m.editable.value!==!0})),_=x(()=>"q-file q-field--auto-height"+(h.value===!0?" q-file--dnd":"")),o=x(()=>a.multiple===!0&&a.append===!0);function g(e){const t=d.value.slice();t.splice(e,1),s(t)}function A(e){const t=d.value.indexOf(e);t!==-1&&g(t)}function s(e){q("update:modelValue",a.multiple===!0?e:e[0])}function v(e){e.keyCode===13&&Ce(e)}function M(e){(e.keyCode===13||e.keyCode===32)&&k(e)}function G(){return w.value}function U(e,t){const n=T(e,t,d.value,o.value),f=G();f!=null&&(f.value=""),n!==void 0&&((a.multiple===!0?a.modelValue&&n.every(c=>d.value.includes(c)):a.modelValue===n[0])||s(o.value===!0?d.value.concat(n):n))}function E(){return[O("input",{class:[a.inputClass,"q-file__filler"],style:a.inputStyle})]}function Z(){if(i.file!==void 0)return d.value.length===0?E():d.value.map((t,n)=>i.file({index:n,file:t,ref:this}));if(i.selected!==void 0)return d.value.length===0?E():i.selected({files:d.value,ref:this});if(a.useChips===!0)return d.value.length===0?E():d.value.map((t,n)=>O(Pe,{key:"file-"+n,removable:m.editable.value,dense:!0,textColor:a.color,tabindex:a.tabindex,onRemove:()=>{g(n)}},()=>O("span",{class:"ellipsis",textContent:t.name})));const e=a.displayValue!==void 0?a.displayValue:X.value;return e.length!==0?[O("div",{class:a.inputClass,style:a.inputStyle,textContent:e})]:E()}function ee(){const e={ref:w,...F.value,...j.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:U};return a.multiple===!0&&(e.multiple=!0),O("input",e)}return Object.assign(m,{fieldClass:_,emitValue:s,hasValue:Q,inputRef:w,innerValue:d,floatingLabel:x(()=>Q.value===!0||se(a.displayValue)),computedCounter:x(()=>{if(a.counterLabel!==void 0)return a.counterLabel(p.value);const e=a.maxFiles;return`${d.value.length}${e!==void 0?" / "+e:""} (${l.value})`}),getControlChild:()=>R("file"),getControl:()=>{const e={ref:m.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:a.tabindex};return m.editable.value===!0&&Object.assign(e,{onDragover:P,onDragleave:S,onKeydown:v,onKeyup:M}),O("div",e,[ee()].concat(Z()))}}),Object.assign(r,{removeAtIndex:g,removeFile:A,getNativeElement:()=>w.value}),xe(r,"nativeEl",()=>w.value),we(m)}}),ze={class:"section-header"},Ie={class:"row q-gutter-sm items-center"},qe={class:"row q-col-gutter-md q-mt-sm items-center"},Re={key:0,class:"q-mt-md"},je=["src"],Ne={class:"section-header"},Oe={class:"row q-gutter-sm items-center"},Le={key:0,class:"q-mt-sm"},Te={class:"section-header"},Qe={class:"row q-gutter-sm items-center"},Ee={key:0,class:"q-mt-md"},We=["src"],$e={__name:"FileToolsPage",setup(a){const i=_e(),q=y(!1),V=y(null),r=y(null),m=y(null),w=y(!0),h=y("png"),L=[{label:"PNG",value:"png"},{label:"JPEG",value:"jpeg"},{label:"WEBP",value:"webp"}],k=y(null);let P=0,S=0;function T(e){if(k.value=null,!e){r.value=null,m.value=null,P=0,S=0;return}const t=e,n=new FileReader;n.onload=f=>{const c=new Image;c.onload=()=>{P=c.width,S=c.height,r.value=P,m.value=S},c.src=f.target.result},n.readAsDataURL(t)}let R=!1,j=!1;function d(e){w.value&&(j||!e||P===0||(R=!0,m.value=Math.round(e*S/P),R=!1))}function Q(e){w.value&&(R||!e||S===0||(j=!0,r.value=Math.round(e*P/S),j=!1))}function X(){if(!V.value){i.notify({type:"negative",message:"請先選擇圖片檔！"});return}const e=V.value,t=new FileReader;t.onload=n=>{const f=new Image;f.onload=()=>{const c=document.createElement("canvas");c.width=r.value||f.width,c.height=m.value||f.height;const C=c.getContext("2d");C.clearRect(0,0,c.width,c.height),C.drawImage(f,0,0,c.width,c.height);const B=h.value,D=B==="jpeg"||B==="webp"?.92:void 0;k.value=c.toDataURL(`image/${B}`,D),i.notify({type:"positive",message:"圖片轉換完成"})},f.onerror=()=>{i.notify({type:"negative",message:"圖片載入失敗"})},f.src=n.target.result},t.readAsDataURL(e)}function l(){if(!k.value)return;const e=typeof h.value=="string"?h.value:h.value?.value,t=document.createElement("a");t.href=k.value,t.download=`converted_image.${e}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}const p=y(null),F=y(null),_=y(!1);function o(){if(F.value=null,_.value=!1,!p.value)return;const e=p.value,t=e.name.toLowerCase();if(!t.endsWith(".pdf")&&!t.endsWith(".xps")){i.notify({type:"negative",message:"請選擇 PDF 或 XPS 檔案"});return}const n=new FileReader;n.onload=f=>{const c=f.target.result,C=new Uint8Array(c);let B="";for(let z=0;z<C.byteLength;z++)B+=String.fromCharCode(C[z]);const D=btoa(B);F.value=D,_.value=!0,i.notify({type:"positive",message:"已成功轉為 Base64"})},n.onerror=()=>{i.notify({type:"negative",message:"讀取檔案發生錯誤"})},n.readAsArrayBuffer(e)}const g=y("pdf"),A=[{label:"PDF",value:"pdf"},{label:"XPS",value:"xps"}],s=y("");function v(){if(!s.value){i.notify({type:"negative",message:"請先貼上 Base64 內容"});return}try{const e=atob(s.value),t=new Array(e.length);for(let z=0;z<e.length;z++)t[z]=e.charCodeAt(z);const n=new Uint8Array(t);let f="application/pdf",c="pdf";g.value==="xps"&&(f="application/vnd.ms-xpsdocument",c="xps");const C=new Blob([n],{type:f}),B=URL.createObjectURL(C),D=document.createElement("a");D.href=B,D.download=`converted_file.${c}`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(B),i.notify({type:"positive",message:"下載完成"})}catch(e){i.notify({type:"negative",message:"Base64 轉檔失敗！"+e.message})}}function M(){if(!F.value){i.notify({type:"warning",message:"沒有 Base64 內容可複製"});return}navigator.clipboard.writeText(F.value).then(()=>{i.notify({type:"positive",message:"Base64 已複製到剪貼簿"})}).catch(()=>{i.notify({type:"negative",message:"複製失敗，請手動複製"})})}function G(){navigator.clipboard.readText().then(e=>{s.value=e,i.notify({type:"info",message:"已貼上剪貼簿內容"})}).catch(()=>{i.notify({type:"negative",message:"無法貼上剪貼簿內容"})})}const U=y(null);function E(){try{const e=atob(s.value),t=new Array(e.length);for(let C=0;C<e.length;C++)t[C]=e.charCodeAt(C);const n=new Uint8Array(t),f=new Blob([n],{type:"application/pdf"}),c=URL.createObjectURL(f);U.value=c,i.notify({type:"positive",message:"PDF 預覽已更新"})}catch(e){i.notify({type:"negative",message:"無法預覽 PDF："+e.message})}}function Z(){U.value&&URL.revokeObjectURL(U.value),U.value=null,s.value=""}function ee(){F.value="",p.value=null}return(e,t)=>(H(),oe(Ae,{padding:"",class:"converter-page"},{default:N(()=>[u(te,{class:ae(["section-card image-convert q-mb-lg",{"dark-card":W(i).dark.isActive,"light-card":!W(i).dark.isActive}])},{default:N(()=>[u(le,null,{default:N(()=>[b("div",ze,[u(ie,{name:"photo",size:"24px",class:"q-mr-sm"}),t[9]||(t[9]=b("h5",{class:"section-title"},"圖片轉檔與大小調整",-1))]),b("div",Ie,[u(ue,{modelValue:V.value,"onUpdate:modelValue":[t[0]||(t[0]=n=>V.value=n),T],label:"選擇圖片檔",accept:"image/*",filled:"",class:"my-file flex-1"},null,8,["modelValue"]),u(I,{icon:"autorenew",onClick:X,color:"primary",dense:"",round:"","aria-label":"轉換圖片"})]),b("div",qe,[u(Y,{modelValue:r.value,"onUpdate:modelValue":[t[1]||(t[1]=n=>r.value=n),d],modelModifiers:{number:!0},type:"number",label:"寬度 (px)",dense:"",class:"dim-input"},null,8,["modelValue"]),u(Y,{modelValue:m.value,"onUpdate:modelValue":[t[2]||(t[2]=n=>m.value=n),Q],modelModifiers:{number:!0},type:"number",label:"高度 (px)",dense:"",class:"dim-input"},null,8,["modelValue"]),u(ke,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=n=>w.value=n),label:"保持比例",dense:""},null,8,["modelValue"]),u(re,{modelValue:h.value,"onUpdate:modelValue":t[4]||(t[4]=n=>h.value=n),options:L,label:"輸出格式",dense:"",class:"format-select"},null,8,["modelValue"])]),k.value?(H(),ne("div",Re,[t[10]||(t[10]=b("h6",{class:"preview-title"},"轉換結果預覽",-1)),b("img",{src:k.value,alt:"converted",class:"converted-image-preview q-mb-sm"},null,8,je),u(I,{icon:"download",onClick:l,color:"secondary",dense:"",round:"","aria-label":"下載圖片"})])):K("",!0)]),_:1})]),_:1},8,["class"]),u(te,{class:ae(["section-card doc-base64 q-mb-lg",{"dark-card-red":W(i).dark.isActive,"light-card":!W(i).dark.isActive}])},{default:N(()=>[u(le,null,{default:N(()=>[b("div",Ne,[u(ie,{name:"description",size:"24px",class:"q-mr-sm"}),t[11]||(t[11]=b("h5",{class:"section-title"},"XPS 或 PDF 轉 Base64",-1))]),b("div",Oe,[u(ue,{modelValue:p.value,"onUpdate:modelValue":[t[5]||(t[5]=n=>p.value=n),o],label:"選擇 XPS 或 PDF 檔",accept:".pdf,.xps,application/pdf,application/vnd.ms-xpsdocument",filled:"",class:"my-file",style:{"min-width":"500px"}},null,8,["modelValue"]),u(I,{icon:"content_copy",color:"primary",onClick:M,unelevated:"",rounded:"",dense:"","aria-label":"複製 Base64"}),u(I,{icon:"clear",color:"warning",onClick:ee,dense:"",rounded:"","aria-label":"清除"})]),_.value?(H(),ne("div",Le,[u(Y,{type:"textarea",label:"Base64 內容",modelValue:F.value,"onUpdate:modelValue":t[6]||(t[6]=n=>F.value=n),class:"base64-textarea fixed-height",readonly:"",dense:""},null,8,["modelValue"])])):K("",!0)]),_:1})]),_:1},8,["class"]),u(te,{class:ae(["section-card base64-download",{"dark-card-pink":W(i).dark.isActive,"light-card":!W(i).dark.isActive}])},{default:N(()=>[u(le,null,{default:N(()=>[b("div",Te,[u(ie,{name:"cloud_download",size:"24px",class:"q-mr-sm"}),t[12]||(t[12]=b("h5",{class:"section-title"},"Base64 轉 PDF/XPS 下載",-1))]),u(Y,{type:"textarea",label:"請貼上 Base64 內容",modelValue:s.value,"onUpdate:modelValue":t[7]||(t[7]=n=>s.value=n),class:"base64-textarea fixed-height q-mb-sm",dense:""},null,8,["modelValue"]),b("div",Qe,[u(re,{modelValue:g.value,"onUpdate:modelValue":t[8]||(t[8]=n=>g.value=n),options:A,label:"選擇下載格式",dense:"",style:{"min-width":"250px"}},null,8,["modelValue"]),q.value?(H(),oe(I,{key:0,icon:"download",onClick:v,color:"primary",disable:!s.value,dense:"",round:"","aria-label":"下載檔案"},null,8,["disable"])):K("",!0),u(I,{icon:"content_paste",onClick:G,flat:"",round:"",dense:"","aria-label":"貼上剪貼簿"}),u(I,{icon:"visibility",onClick:E,color:"secondary",dense:"",round:"","aria-label":"預覽 PDF"}),u(I,{icon:"clear",color:"warning",onClick:Z,dense:"",round:"","aria-label":"清除預覽"})]),U.value?(H(),ne("div",Ee,[t[13]||(t[13]=b("h6",{class:"preview-title"},"PDF 預覽",-1)),b("iframe",{src:U.value,width:"100%",height:"500px",class:"pdf-preview-frame"},null,8,We)])):K("",!0)]),_:1})]),_:1},8,["class"])]),_:1}))}},tt=Ve($e,[["__scopeId","data-v-41318733"]]);export{tt as default};
